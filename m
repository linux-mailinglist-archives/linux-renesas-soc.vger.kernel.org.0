Return-Path: <linux-renesas-soc-owner@vger.kernel.org>
X-Original-To: lists+linux-renesas-soc@lfdr.de
Delivered-To: lists+linux-renesas-soc@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 530D23B29F2
	for <lists+linux-renesas-soc@lfdr.de>; Thu, 24 Jun 2021 10:07:45 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S231862AbhFXIKC (ORCPT <rfc822;lists+linux-renesas-soc@lfdr.de>);
        Thu, 24 Jun 2021 04:10:02 -0400
Received: from mail-vs1-f43.google.com ([209.85.217.43]:34684 "EHLO
        mail-vs1-f43.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S231859AbhFXIKC (ORCPT
        <rfc822;linux-renesas-soc@vger.kernel.org>);
        Thu, 24 Jun 2021 04:10:02 -0400
Received: by mail-vs1-f43.google.com with SMTP id x1so2987318vsc.1
        for <linux-renesas-soc@vger.kernel.org>; Thu, 24 Jun 2021 01:07:42 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:mime-version:references:in-reply-to:from:date
         :message-id:subject:to:cc;
        bh=aZJZEnocSqLhpnyQwHKQH/OxPp1Q73kOuthepAlN9Hg=;
        b=TxBXltIEjowSKj81oMriM7ub0KsUnDe8Ba5wiMobYyzE12HnnSGs8SGEr9qs5KpvOw
         QSuQ5g2khDuereYzr2WdpxhTXy+t8MxR1rQ46LZ30V32t8VlSMUvySvZ/IlIq+9QFneW
         s5f9OcsCRYlmb4WOhv/0IQWdRKL18lmEDaQONPWF1AjdEMnX8lh2LH0qYknSxOQabESF
         anit2PgbQk8tPCoA0vLy2mlFXE4EfnNzJUkjBoylGrvPcdDEMD8ldYfcJxUp0wztCxc5
         cSpGvbuK6LHeCs4BpFKuOwv3OBOrAo9LL31NJ6SFRW3Qxmc7TMj+1BhIUt5XrSTz/TV0
         PffQ==
X-Gm-Message-State: AOAM533aHiV+XQniFWf4eBfPG0+voXXAiDaP2p7mSHGGjlAivXpX7Kr0
        CM3LL+RY3q59R1Je/CVmuFpeBHE1fzHCM9pFd/Ua5dn3RNZ9og==
X-Google-Smtp-Source: ABdhPJwCvbS9PCAqGzEr085d4EnmRKTnxpJYld7B4ziliX+4L3yTlo2WUkg46kKkn/PdDgpSoScjd3VpLBqU8XWLEE8=
X-Received: by 2002:a67:3c2:: with SMTP id 185mr1611702vsd.42.1624522061995;
 Thu, 24 Jun 2021 01:07:41 -0700 (PDT)
MIME-Version: 1.0
References: <cover.1624460378.git.geert+renesas@glider.be> <b7b53970-58ea-f27f-4190-0066cb30cb05@ideasonboard.com>
In-Reply-To: <b7b53970-58ea-f27f-4190-0066cb30cb05@ideasonboard.com>
From:   Geert Uytterhoeven <geert@linux-m68k.org>
Date:   Thu, 24 Jun 2021 10:07:30 +0200
Message-ID: <CAMuHMdWSeeifBLqi4S6LrgcQg9E_1xFXzLzBBBqMf1Fc0kbMhg@mail.gmail.com>
Subject: Re: [PATCH 0/2] arm64: dts: renesas: r8a779a0: Add INTC-EX support
To:     Kieran Bingham <kieran.bingham@ideasonboard.com>
Cc:     Yoshihiro Shimoda <yoshihiro.shimoda.uh@renesas.com>,
        Kieran Bingham <kieran.bingham+renesas@ideasonboard.com>,
        Linux-Renesas <linux-renesas-soc@vger.kernel.org>
Content-Type: text/plain; charset="UTF-8"
Precedence: bulk
List-ID: <linux-renesas-soc.vger.kernel.org>
X-Mailing-List: linux-renesas-soc@vger.kernel.org

Hi Kieran,

On Wed, Jun 23, 2021 at 6:13 PM Kieran Bingham
<kieran.bingham@ideasonboard.com> wrote:
> On 23/06/2021 16:02, Geert Uytterhoeven wrote:
> > This patch series adds support for the Interrupt Controller for External
> > Devices (INT-EC) in the Renesas R-Car V3U (r8a779a0) SoC.
> >
> > As there are two known issues, I'm posting this to a limited audience:
> >
> >   1. External interrupts have not been tested.
> >
> >      Kieran: perhaps IRQ0 can be tested on Falcon with the MIPI DSI/eDP
> >      bridge, by changing
> >
> >        -    interrupt-parent = <&gpio1>;
> >        -    interrupts = <24 IRQ_TYPE_LEVEL_HIGH>;
> >        +    interrupt-parent = <&intc_ex>;
> >        +    interrupts = <0 IRQ_TYPE_LEVEL_HIGH>;
> >
> >      ? The "ti,sn65dsi86" driver doesn't seem to use interrupts, though,
> >      so I don't know how feasible this is.
>
> I can add an interrupt handler if that's what you need, but I suspect
> that the change here simply 're-routes' the interrupt through the
> intc_ex so that it still needs an interrupt to be generated by the
> SN65DSI86? is that right?

Correct, you need to make the SN65DSI86 generate an interrupt, too.
No idea how to do that...

> >      Alternatively, with physical access, IRQ0 is available on test
> >      point CP47, and IRQ2 on the GPIO CN.
>
> I do have physical access, so I can trigger this - Is there a suitable
> voltage or condition I can apply? (I.e. take a signal from a nearby pin
> to short it?)

As IRQ0 is driven by the single gate U59, you better don't cause logic
conflicts, and play with IRQ2 instead.

Note that high level is SPI_D1.8V/3.3V, which is 1.8V by default!
The GPIO CN connector carries a.o. SPI_D1.8V/3.3V and GND.
Internal pull-up should be enabled for IRQ2 by reset state, but you
may want to measure the pin's voltage to be sure.

To configure pin control, you need to add the following, and hook it
up to the pfc node:

        irq2_pins: irq2 {
                groups = "intc_ex_irq2";
                function = "intc_ex";
        };

You should be able to test this using gpio-keys, with a key subnode that
has an interrupts instead of a gpios property.

This might be a good opportunity to wire up the slide and push switches
(SW46-49) as gpio-keys, too...

Thanks!

Gr{oetje,eeting}s,

                        Geert

--
Geert Uytterhoeven -- There's lots of Linux beyond ia32 -- geert@linux-m68k.org

In personal conversations with technical people, I call myself a hacker. But
when I'm talking to journalists I just say "programmer" or something like that.
                                -- Linus Torvalds
