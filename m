Return-Path: <linux-renesas-soc-owner@vger.kernel.org>
X-Original-To: lists+linux-renesas-soc@lfdr.de
Delivered-To: lists+linux-renesas-soc@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 91DD0485B97
	for <lists+linux-renesas-soc@lfdr.de>; Wed,  5 Jan 2022 23:27:23 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S244883AbiAEW1W (ORCPT <rfc822;lists+linux-renesas-soc@lfdr.de>);
        Wed, 5 Jan 2022 17:27:22 -0500
Received: from perceval.ideasonboard.com ([213.167.242.64]:34424 "EHLO
        perceval.ideasonboard.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S244900AbiAEW1U (ORCPT
        <rfc822;linux-renesas-soc@vger.kernel.org>);
        Wed, 5 Jan 2022 17:27:20 -0500
Received: from pendragon.ideasonboard.com (cpc89244-aztw30-2-0-cust3082.18-1.cable.virginm.net [86.31.172.11])
        by perceval.ideasonboard.com (Postfix) with ESMTPSA id A44D5993;
        Wed,  5 Jan 2022 23:27:18 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=ideasonboard.com;
        s=mail; t=1641421638;
        bh=P5aDhAeXfy2pZ5RYnoDlFN5apynw5rZr+wAvSSP2cH4=;
        h=In-Reply-To:References:Subject:From:Cc:To:Date:From;
        b=aeB8RImojFG6DYb+WB2bQAsUbN6lzvsVssBZxqKwwHusMHkwmQj9X0IznJ0GO4NAf
         /IoG1HSAlMootKr5U4akdfiirHTa+UdInD1BzrSo6jc8Mft12U4IYcjRedBm5H24Yk
         2VqnWwLj3c1Iw/sGnthuANaNQMzmh2Nvp5X+68d8=
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: quoted-printable
In-Reply-To: <CAMuHMdWSeeifBLqi4S6LrgcQg9E_1xFXzLzBBBqMf1Fc0kbMhg@mail.gmail.com>
References: <cover.1624460378.git.geert+renesas@glider.be> <b7b53970-58ea-f27f-4190-0066cb30cb05@ideasonboard.com> <CAMuHMdWSeeifBLqi4S6LrgcQg9E_1xFXzLzBBBqMf1Fc0kbMhg@mail.gmail.com>
Subject: Re: [PATCH 0/2] arm64: dts: renesas: r8a779a0: Add INTC-EX support
From:   Kieran Bingham <kieran.bingham@ideasonboard.com>
Cc:     Yoshihiro Shimoda <yoshihiro.shimoda.uh@renesas.com>,
        Linux-Renesas <linux-renesas-soc@vger.kernel.org>
To:     Geert Uytterhoeven <geert@linux-m68k.org>
Date:   Wed, 05 Jan 2022 22:27:16 +0000
Message-ID: <164142163602.514996.11696708354448856022@Monstersaurus>
User-Agent: alot/0.10
Precedence: bulk
List-ID: <linux-renesas-soc.vger.kernel.org>
X-Mailing-List: linux-renesas-soc@vger.kernel.org

Hi Geert,

Quoting Geert Uytterhoeven (2021-06-24 09:07:30)
> Hi Kieran,
>=20
> On Wed, Jun 23, 2021 at 6:13 PM Kieran Bingham
> <kieran.bingham@ideasonboard.com> wrote:
> > On 23/06/2021 16:02, Geert Uytterhoeven wrote:
> > > This patch series adds support for the Interrupt Controller for Exter=
nal
> > > Devices (INT-EC) in the Renesas R-Car V3U (r8a779a0) SoC.
> > >
> > > As there are two known issues, I'm posting this to a limited audience:
> > >
> > >   1. External interrupts have not been tested.
> > >
> > >      Kieran: perhaps IRQ0 can be tested on Falcon with the MIPI DSI/e=
DP
> > >      bridge, by changing
> > >
> > >        -    interrupt-parent =3D <&gpio1>;
> > >        -    interrupts =3D <24 IRQ_TYPE_LEVEL_HIGH>;
> > >        +    interrupt-parent =3D <&intc_ex>;
> > >        +    interrupts =3D <0 IRQ_TYPE_LEVEL_HIGH>;
> > >
> > >      ? The "ti,sn65dsi86" driver doesn't seem to use interrupts, thou=
gh,
> > >      so I don't know how feasible this is.
> >
> > I can add an interrupt handler if that's what you need, but I suspect
> > that the change here simply 're-routes' the interrupt through the
> > intc_ex so that it still needs an interrupt to be generated by the
> > SN65DSI86? is that right?
>=20
> Correct, you need to make the SN65DSI86 generate an interrupt, too.
> No idea how to do that...

   o/ Oh oh I do I do ... (now).

I've added a handler, enabled all interrupts on the device and given
myself an interrupt storm:

 95:       3203      irqc   0 Level     sn65dsi86-irq

So I believe I can now (finally) add a=20

Tested-by: Kieran Bingham <kieran.bingham+renesas@ideasonboard.com>

here.

And I'll continue working on the interrupt handling for the SN65DSI86 to
see if I can add hotplug detection over interrupts.



>=20
> > >      Alternatively, with physical access, IRQ0 is available on test
> > >      point CP47, and IRQ2 on the GPIO CN.
> >
> > I do have physical access, so I can trigger this - Is there a suitable
> > voltage or condition I can apply? (I.e. take a signal from a nearby pin
> > to short it?)
>=20
> As IRQ0 is driven by the single gate U59, you better don't cause logic
> conflicts, and play with IRQ2 instead.
>=20
> Note that high level is SPI_D1.8V/3.3V, which is 1.8V by default!
> The GPIO CN connector carries a.o. SPI_D1.8V/3.3V and GND.
> Internal pull-up should be enabled for IRQ2 by reset state, but you
> may want to measure the pin's voltage to be sure.
>=20
> To configure pin control, you need to add the following, and hook it
> up to the pfc node:
>=20
>         irq2_pins: irq2 {
>                 groups =3D "intc_ex_irq2";
>                 function =3D "intc_ex";
>         };
>=20
> You should be able to test this using gpio-keys, with a key subnode that
> has an interrupts instead of a gpios property.
>=20
> This might be a good opportunity to wire up the slide and push switches
> (SW46-49) as gpio-keys, too...
>=20
> Thanks!
>=20
> Gr{oetje,eeting}s,
>=20
>                         Geert
>=20
> --
> Geert Uytterhoeven -- There's lots of Linux beyond ia32 -- geert@linux-m6=
8k.org
>=20
> In personal conversations with technical people, I call myself a hacker. =
But
> when I'm talking to journalists I just say "programmer" or something like=
 that.
>                                 -- Linus Torvalds
